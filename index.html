<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµªæ¼«å‘Šç™½</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }
        body {
            background: #fdf2f8;
            overflow-x: hidden;
        }
        /* ç²’å­å®¹å™¨ */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1;
        }
        .particle {
            position: absolute;
            pointer-events: none;
        }
        /* å§“åè¾“å…¥å®¹å™¨ */
        #nameContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            text-align: center;
            background: #fff;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(255, 107, 153, 0.3);
        }
        #nameContainer.hidden {
            display: none;
        }
        #nameContainer h2 {
            color: #e53e3e;
            margin-bottom: 1rem;
        }
        #targetName {
            padding: 0.8rem 1rem;
            width: 280px;
            border: 2px solid #fbb6ce;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            outline: none;
        }
        #targetName:focus {
            border-color: #e53e3e;
        }
        #startBtn {
            padding: 0.8rem 2rem;
            background: #e53e3e;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        #startBtn:hover {
            background: #c53030;
        }
        .share-tip {
            margin-top: 1rem;
            color: #666;
            display: none;
        }
        #shareLink {
            display: none;
            margin-top: 0.5rem;
            padding: 0.5rem;
            background: #f5f5f5;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #333;
            word-break: break-all;
        }
        /* å‘Šç™½å¼¹çª— */
        #confessionModal, #successModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(255, 107, 153, 0.5);
            text-align: center;
            max-width: 80%;
        }
        #confessionTitle {
            color: #e53e3e;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }
        #confessionText {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 2rem;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #confessionText.show {
            opacity: 1;
        }
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        #acceptBtn {
            background: #e53e3e;
            color: #fff;
        }
        #acceptBtn:hover {
            background: #c53030;
        }
        #refuseBtn {
            background: #666;
            color: #fff;
            position: relative; /* é…åˆèº²é¿é€»è¾‘ */
        }
        #successText {
            color: #e53e3e;
            font-size: 1.5rem;
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <!-- ç²’å­å®¹å™¨ -->
    <div id="particle-container"></div>

    <!-- å§“åè¾“å…¥å®¹å™¨ -->
    <div id="nameContainer">
        <h2>è¾“å…¥TAçš„åå­—ï¼Œç”Ÿæˆå‘Šç™½é“¾æ¥ ğŸ’“</h2>
        <input type="text" id="targetName" placeholder="è¯·è¾“å…¥TAçš„åå­—">
        <button id="startBtn">ç”Ÿæˆå‘Šç™½é“¾æ¥</button>
        <div class="share-tip" id="shareTip">å¤åˆ¶ä¸‹æ–¹é“¾æ¥å‘ç»™TAå§ ğŸ’Œ</div>
        <div id="shareLink"></div>
    </div>

    <!-- å‘Šç™½å¼¹çª— -->
    <div id="confessionModal">
        <div class="modal-content">
            <h2 id="confessionTitle"></h2>
            <p id="confessionText"></p>
            <div class="btn-group">
                <button class="btn" id="acceptBtn">æˆ‘æ„¿æ„ ğŸ’–</button>
                <button class="btn" id="refuseBtn">ä¸æ„¿æ„ ğŸ˜¤</button>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸå¼¹çª— -->
    <div id="successModal">
        <div class="modal-content">
            <p id="successText"></p>
        </div>
    </div>

    <script>
        // æµªæ¼«è¯—æ„å‘Šç™½æ–‡æ¡ˆåº“ï¼ˆé€æ®µå±•ç¤ºï¼‰
        const confessionTexts = [
            "æ˜Ÿæ²³æ»šçƒ«ï¼Œä½ æ˜¯äººé—´ç†æƒ³ï¼›å±±é‡åƒé‡Œï¼Œä½ æ˜¯è—åœ¨å¾®é£é‡Œçš„æ¬¢å–œã€‚",
            "æˆ‘è§è¿‡æ˜¥æ—¥å¤é£ï¼Œç§‹å¶å†¬é›ªï¼Œä¹Ÿè¸éå—æ°´åŒ—å±±ï¼Œä¸œéº“è¥¿å²­ï¼Œå¯è¿™å››å­£æ˜¥ç§‹ï¼Œè‹å±±æ³±æ°´ï¼Œéƒ½ä¸åŠä½ å†²æˆ‘å±•çœ‰ä¸€ç¬‘ã€‚",
            "ä½ æ˜¯æˆ‘æç¬”ä¸æ›¾å†™ä¸‹çš„ç»å¥ï¼Œå¦‚æ—é—´æ¾é£æ–°é›ªåˆéœï¼Œåæ¥ç‰©æ¢æ˜Ÿç§»ï¼Œæ–¹çŸ¥ä¸‡äº‹çš†æœ‰è¿¹ï¼Œè€Œä½ æ˜¯æˆ‘çš„æœ€ç»ˆç« ã€‚",
            "æƒ³æŠŠæ»¡å¤©æ˜Ÿæ²³æ‰ç¢äº†æ’’è¿›ä½ çš„çœ¼é‡Œï¼Œä»æ­¤ä½ çš„çœ¼çœ¸ï¼Œä¾¿æ˜¯æˆ‘è§è¿‡æœ€ç’€ç’¨çš„å®‡å®™ã€‚",
            "æˆ‘å¯»äº†åŠç”Ÿçš„æ˜¥å¤©ï¼Œä½ ä¸€ç¬‘ï¼Œä¾¿æ˜¯äº†ã€‚"
        ];

        // ç”Ÿæˆç²’å­ç‰¹æ•ˆï¼ˆçˆ±å¿ƒ/èŠ±ç“£ï¼‰
        function createParticles(type = "petal") {
            const container = document.getElementById('particle-container');
            const count = type === "heart" ? 50 : 80;

            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // éšæœºæ ·å¼
                const size = type === "heart" ? Math.random() * 15 + 10 : Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                
                if (type === "heart") {
                    particle.innerHTML = "â¤ï¸";
                    particle.style.fontSize = `${size}px`;
                    particle.style.animation = `fall ${Math.random() * 25 + 15}s linear infinite`;
                } else {
                    particle.style.background = `rgba(${255},${Math.floor(Math.random() * 150 + 100)},${Math.floor(Math.random() * 150 + 100)},${Math.random() * 0.8 + 0.2})`;
                    particle.style.borderRadius = type === "petal" ? "50% 0" : "50%";
                    particle.style.animation = `fall ${Math.random() * 20 + 10}s linear infinite`;
                }
                
                container.appendChild(particle);
            }
        }

        // ç²’å­ä¸‹è½åŠ¨ç”»
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                @keyframes fall {
                    0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }
                    10% { opacity: 1; }
                    90% { opacity: 1; }
                    100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                }
            </style>
        `);

        // ç”Ÿæˆçˆ†ç‚¸å¼ç²’å­ç‰¹æ•ˆ
        function createExplosion(x, y) {
            const container = document.getElementById('particle-container');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.innerHTML = "â¤ï¸";
                const size = Math.random() * 20 + 10;
                particle.style.fontSize = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.position = 'absolute';
                particle.style.opacity = '1';
                particle.style.pointerEvents = 'none';
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 15 + 5;
                particle.style.animation = `explode ${Math.random() * 2 + 1}s ease-out forwards`;
                particle.style.transform = `translate(${Math.cos(angle) * speed * 10}px,${Math.sin(angle) * speed * 10}px) rotate(360deg)`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 2000);
            }
        }

        document.head.insertAdjacentHTML('beforeend', `
            <style>
                @keyframes explode {
                    0% { opacity: 1; transform: scale(1); }
                    100% { opacity: 0; transform: scale(0); }
                }
            </style>
        `);

        // ä»URLè·å–å‚æ•°
        function getUrlParam(name) {
            const reg = new RegExp(`(^|&)${name}=([^&]*)(&|$)`);
            const r = window.location.search.substr(1).match(reg);
            if (r != null) return decodeURIComponent(r[2]);
            return null;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            createParticles();
            
            // è·å–DOMå…ƒç´ 
            const nameContainer = document.getElementById('nameContainer');
            const confessionModal = document.getElementById('confessionModal');
            const successModal = document.getElementById('successModal');
            const targetNameInput = document.getElementById('targetName');
            const startBtn = document.getElementById('startBtn');
            const confessionTitle = document.getElementById('confessionTitle');
            const confessionText = document.getElementById('confessionText');
            const acceptBtn = document.getElementById('acceptBtn');
            const refuseBtn = document.getElementById('refuseBtn');
            const successText = document.getElementById('successText');
            const shareTip = document.getElementById('shareTip');
            const shareLink = document.getElementById('shareLink');

            // å½“å‰æ–‡æ¡ˆç´¢å¼•
            let textIndex = 0;

            // æ£€æŸ¥URLä¸­æ˜¯å¦æœ‰å§“åå‚æ•°ï¼ˆæ¥æ”¶æ–¹ï¼‰
            const targetName = getUrlParam('name');
            if (targetName) {
                // æ¥æ”¶æ–¹ï¼šéšè—è¾“å…¥æ¡†ï¼Œç›´æ¥æ˜¾ç¤ºå‘Šç™½å¼¹çª—+ç¬¬ä¸€æ®µæ–‡æ¡ˆ
                nameContainer.classList.add('hidden');
                confessionTitle.textContent = `${targetName}ï¼Œæˆ‘å–œæ¬¢ä½ ï¼`;
                showNextText();
                confessionModal.style.display = 'flex';
            } else {
                // å‘é€æ–¹ï¼šæ˜¾ç¤ºè¾“å…¥æ¡†
                nameContainer.classList.remove('hidden');
            }

            // æ˜¾ç¤ºä¸‹ä¸€æ®µæ–‡æ¡ˆ
            function showNextText() {
                if (textIndex < confessionTexts.length) {
                    confessionText.textContent = confessionTexts[textIndex];
                    confessionText.classList.add('show');
                    // ç”Ÿæˆç²’å­ç‰¹æ•ˆ
                    createParticles(textIndex % 2 === 0 ? "petal" : "heart");
                    textIndex++;
                } else {
                    // æ‰€æœ‰æ–‡æ¡ˆå±•ç¤ºå®Œï¼Œè·³è½¬åˆ°æˆåŠŸå¼¹çª—
                    const name = targetName || targetNameInput.value.trim();
                    successText.textContent = `${name}ï¼Œä½™ç”Ÿè¯·å¤šæŒ‡æ•™ ğŸ’`;
                    confessionModal.style.display = 'none';
                    successModal.style.display = 'flex';
                    createParticles("heart");
                }
            }

            // ç”Ÿæˆå‘Šç™½é“¾æ¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆå‘é€æ–¹ï¼‰
            startBtn.addEventListener('click', function() {
                const inputName = targetNameInput.value.trim();
                if (!inputName) {
                    alert('è¯·è¾“å…¥TAçš„åå­—å“¦ ğŸ’“');
                    return;
                }
                
                // ç”Ÿæˆå¸¦å§“åå‚æ•°çš„é“¾æ¥
                const currentUrl = window.location.href.split('?')[0];
                const confessionUrl = `${currentUrl}?name=${encodeURIComponent(inputName)}`;
                
                // æ˜¾ç¤ºåˆ†äº«æç¤ºå’Œé“¾æ¥
                shareTip.style.display = 'block';
                shareLink.style.display = 'block';
                shareLink.textContent = confessionUrl;
                
                // è‡ªåŠ¨å¤åˆ¶é“¾æ¥
                navigator.clipboard.writeText(confessionUrl).then(() => {
                    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥å‘ç»™TAå•¦ ğŸ’Œ');
                }).catch(() => {
                    alert('é“¾æ¥å·²ç”Ÿæˆï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å‘ç»™TA ğŸ’Œ');
                });
            });

            // "ä¸æ„¿æ„"æŒ‰é’®å¼ºåŒ–èº²é¿é€»è¾‘
            refuseBtn.addEventListener('mouseenter', function(e) {
                const btn = e.target;
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const btnWidth = btn.offsetWidth;
                const btnHeight = btn.offsetHeight;

                // éšæœºä½ç½®ï¼ˆç¡®ä¿åœ¨å¯è§†åŒºåŸŸå†…ï¼‰
                const randomX = Math.random() * (windowWidth - btnWidth * 2) + btnWidth;
                const randomY = Math.random() * (windowHeight - btnHeight * 2) + btnHeight;
                // éšæœºå¤§å°
                const randomSize = Math.random() * 0.5 + 0.8;
                // éšæœºé¢œè‰²
                const randomColor = `rgb(${Math.floor(Math.random() * 150)},${Math.floor(Math.random() * 150)},${Math.floor(Math.random() * 150)})`;

                // åº”ç”¨éšæœºæ ·å¼
                btn.style.position = 'absolute';
                btn.style.left = `${randomX}px`;
                btn.style.top = `${randomY}px`;
                btn.style.transform = `scale(${randomSize})`;
                btn.style.backgroundColor = randomColor;
                btn.style.color = '#fff';
            });

            // "æˆ‘æ„¿æ„"æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆé€æ®µå±•ç¤ºæ–‡æ¡ˆï¼‰
            acceptBtn.addEventListener('click', function(e) {
                // ç”Ÿæˆçˆ†ç‚¸ç‰¹æ•ˆ
                createExplosion(e.clientX, e.clientY);
                // éšè—å½“å‰æ–‡æ¡ˆï¼Œå‡†å¤‡æ˜¾ç¤ºä¸‹ä¸€æ®µ
                confessionText.classList.remove('show');
                setTimeout(showNextText, 500);
            });

            // é˜»æ­¢ä¸æ„¿æ„æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
            refuseBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                alert('ä½ ä¸èƒ½æ‹’ç»æˆ‘ ğŸ˜œ');
                return false;
            });
        };
    </script>
</body>
</html>