<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµªæ¼«å‘Šç™½ | æ˜Ÿæ²³äºˆä½ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }
        body {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }
        /* ç²’å­å®¹å™¨ */
        #particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1;
        }
        .particle {
            position: absolute;
            pointer-events: none;
        }
        /* å§“åè¾“å…¥å®¹å™¨ */
        #nameContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2;
            text-align: center;
            background: rgba(255,255,255,0.95);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(255, 107, 153, 0.4);
        }
        #nameContainer.hidden {
            display: none !important;
        }
        #nameContainer h2 {
            color: #e53e3e;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        #targetName {
            padding: 1rem 1.2rem;
            width: 300px;
            border: 2px solid #ff6b9d;
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
            outline: none;
            text-align: center;
        }
        #targetName:focus {
            border-color: #e53e3e;
            box-shadow: 0 0 12px rgba(229, 62, 62, 0.3);
        }
        #startBtn {
            padding: 1rem 2.5rem;
            background: linear-gradient(to right, #ff6b9d, #e53e3e);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        #startBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.4);
        }
        #shareTip {
            margin-top: 1.5rem;
            color: #e53e3e;
            font-size: 1rem;
            display: none;
        }
        #shareLink {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f8f8;
            border-radius: 8px;
            font-size: 0.95rem;
            color: #333;
            word-break: break-all;
            border: 1px solid #ff6b9d;
            max-width: 300px;
        }
        /* å‘Šç™½å¼¹çª— */
        #confessionModal, #successModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background: linear-gradient(135deg, #fff0f5 0%, #ffe4e1 100%);
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(255, 107, 153, 0.6);
            max-width: 85%;
            border: 2px solid #ff6b9d;
        }
        #confessionTitle {
            color: #e53e3e;
            margin-bottom: 2rem;
            font-size: 2rem;
            text-shadow: 0 2px 8px rgba(229, 62, 62, 0.2);
        }
        #confessionText {
            font-size: 1.3rem;
            line-height: 1.8;
            color: #b72424;
            margin-bottom: 2.5rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s ease;
            min-height: 120px;
        }
        #confessionText.show {
            opacity: 1;
            transform: translateY(0);
        }
        .btn-group {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        #acceptBtn {
            background: linear-gradient(to right, #ff6b9d, #e53e3e);
            color: #fff;
        }
        #acceptBtn:hover {
            transform: scale(1.08);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.4);
        }
        #refuseBtn {
            background: #ccc;
            color: #666;
            position: relative;
            transition: all 0.2s ease;
        }
        #successText {
            color: #e53e3e;
            font-size: 1.8rem;
            line-height: 2;
            margin-bottom: 1.5rem;
        }
        .heart {
            font-size: 3rem;
            color: #e53e3e;
            animation: heartBeat 1.5s infinite;
        }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        /* ç²’å­åŠ¨ç”» */
        @keyframes fall {
            0% { transform: translateY(-10px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        @keyframes explode {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0); }
        }
    </style>
</head>
<body>
    <!-- ç²’å­å®¹å™¨ -->
    <div id="particle-container"></div>

    <!-- å§“åè¾“å…¥å®¹å™¨ -->
    <div id="nameContainer">
        <h2>ğŸ’– è¾“å…¥TAçš„åå­—ï¼Œç”Ÿæˆä¸“å±å‘Šç™½ ğŸ’–</h2>
        <input type="text" id="targetName" placeholder="è¯·è¾“å…¥å‘Šç™½å¯¹è±¡çš„åå­—">
        <button id="startBtn">ç”Ÿæˆå‘Šç™½é“¾æ¥</button>
        <div id="shareTip">âœ¨ å¤åˆ¶ä¸‹æ–¹é“¾æ¥å‘ç»™TAå§ âœ¨</div>
        <div id="shareLink"></div>
    </div>

    <!-- å‘Šç™½å¼¹çª— -->
    <div id="confessionModal">
        <div class="modal-content">
            <h2 id="confessionTitle"></h2>
            <div id="confessionText"></div>
            <div class="btn-group">
                <button class="btn" id="acceptBtn">æˆ‘æ„¿æ„ ğŸ’–</button>
                <button class="btn" id="refuseBtn">ä¸æ„¿æ„</button>
            </div>
        </div>
    </div>

    <!-- æˆåŠŸå¼¹çª— -->
    <div id="successModal">
        <div class="modal-content">
            <h1>ğŸ‰ å‘Šç™½æˆåŠŸï¼ğŸ‰</h1>
            <div id="successText"></div>
            <div class="heart">â¤ï¸</div>
            <p style="margin-top: 1rem; color: #b72424; font-size: 1.2rem;">æ„¿æˆ‘ä»¬å²å²å¹´å¹´ï¼Œæ»¡å¿ƒæ¬¢å–œ</p>
        </div>
    </div>

    <script>
        // æµªæ¼«æ–‡æ¡ˆåº“
        const confessionTexts = [
            "æ˜Ÿæ²³æ»šçƒ«ï¼Œä½ æ˜¯äººé—´ç†æƒ³ï¼›å±±é‡åƒé‡Œï¼Œä½ æ˜¯è—åœ¨å¾®é£é‡Œçš„æ¬¢å–œã€‚",
            "æˆ‘è§è¿‡æ˜¥æ—¥å¤é£ï¼Œç§‹å¶å†¬é›ªï¼Œä¹Ÿè¸éå—æ°´åŒ—å±±ï¼Œä¸œéº“è¥¿å²­ï¼Œå¯è¿™å››å­£æ˜¥ç§‹ï¼Œè‹å±±æ³±æ°´ï¼Œéƒ½ä¸åŠä½ å†²æˆ‘å±•çœ‰ä¸€ç¬‘ã€‚",
            "ä½ æ˜¯æˆ‘æç¬”ä¸æ›¾å†™ä¸‹çš„ç»å¥ï¼Œå¦‚æ—é—´æ¾é£æ–°é›ªåˆéœï¼Œåæ¥ç‰©æ¢æ˜Ÿç§»ï¼Œæ–¹çŸ¥ä¸‡äº‹çš†æœ‰è¿¹ï¼Œè€Œä½ æ˜¯æˆ‘çš„æœ€ç»ˆç« ã€‚",
            "æƒ³æŠŠæ»¡å¤©æ˜Ÿæ²³æ‰ç¢äº†æ’’è¿›ä½ çš„çœ¼é‡Œï¼Œä»æ­¤ä½ çš„çœ¼çœ¸ï¼Œä¾¿æ˜¯æˆ‘è§è¿‡æœ€ç’€ç’¨çš„å®‡å®™ã€‚",
            "æˆ‘å¯»äº†åŠç”Ÿçš„æ˜¥å¤©ï¼Œä½ ä¸€ç¬‘ï¼Œä¾¿æ˜¯äº†ã€‚"
        ];

        // ç”Ÿæˆç²’å­ç‰¹æ•ˆ
        function createParticles(type = "petal") {
            const container = document.getElementById('particle-container');
            if (!container) return; // å®¹é”™å¤„ç†
            const count = type === "heart" ? 50 : 80;

            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = type === "heart" ? Math.random() * 15 + 10 : Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                
                if (type === "heart") {
                    particle.innerHTML = "â¤ï¸";
                    particle.style.fontSize = `${size}px`;
                    particle.style.animation = `fall ${Math.random() * 25 + 15}s linear infinite`;
                } else {
                    particle.style.background = `rgba(${255},${Math.floor(Math.random() * 150 + 100)},${Math.floor(Math.random() * 150 + 100)},${Math.random() * 0.8 + 0.2})`;
                    particle.style.borderRadius = type === "petal" ? "50% 0" : "50%";
                    particle.style.animation = `fall ${Math.random() * 20 + 10}s linear infinite`;
                }
                
                container.appendChild(particle);
            }
        }

        // çˆ†ç‚¸ç²’å­ç‰¹æ•ˆ
        function createExplosion(x, y) {
            const container = document.getElementById('particle-container');
            if (!container) return;
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.innerHTML = "â¤ï¸";
                const size = Math.random() * 20 + 10;
                particle.style.fontSize = `${size}px`;
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.position = 'absolute';
                particle.style.opacity = '1';
                particle.style.pointerEvents = 'none';
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 15 + 5;
                particle.style.animation = `explode ${Math.random() * 2 + 1}s ease-out forwards`;
                particle.style.transform = `translate(${Math.cos(angle) * speed * 10}px,${Math.sin(angle) * speed * 10}px) rotate(360deg)`;
                container.appendChild(particle);
                setTimeout(() => particle.remove(), 2000);
            }
        }

        // è·å–URLå‚æ•°
        function getUrlParam(name) {
            const reg = new RegExp(`(^|&)${name}=([^&]*)(&|$)`);
            const r = window.location.search.substr(1).match(reg);
            return r ? decodeURIComponent(r[2]) : null;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ï¼ˆDOMContentLoadedå…¼å®¹æ€§æ›´å¥½ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ç²’å­
            createParticles();

            // è·å–æ‰€æœ‰DOMå…ƒç´ ï¼ˆå¢åŠ å®¹é”™ï¼‰
            const nameContainer = document.getElementById('nameContainer') || {};
            const confessionModal = document.getElementById('confessionModal') || {};
            const successModal = document.getElementById('successModal') || {};
            const targetNameInput = document.getElementById('targetName');
            const startBtn = document.getElementById('startBtn');
            const confessionTitle = document.getElementById('confessionTitle') || {};
            const confessionText = document.getElementById('confessionText') || {};
            const acceptBtn = document.getElementById('acceptBtn');
            const refuseBtn = document.getElementById('refuseBtn');
            const successText = document.getElementById('successText') || {};
            const shareTip = document.getElementById('shareTip');
            const shareLink = document.getElementById('shareLink');

            // æ–‡æ¡ˆç´¢å¼•
            let textIndex = 0;

            // æ£€æŸ¥URLä¸­çš„å§“åå‚æ•°
            const targetName = getUrlParam('name');
            if (targetName && nameContainer.classList) {
                nameContainer.classList.add('hidden');
                if (confessionTitle.textContent !== undefined) {
                    confessionTitle.textContent = `${targetName}ï¼Œæˆ‘å–œæ¬¢ä½ ï¼`;
                }
                showNextText();
                if (confessionModal.style) {
                    confessionModal.style.display = 'flex';
                }
            }

            // æ˜¾ç¤ºä¸‹ä¸€æ®µæ–‡æ¡ˆ
            function showNextText() {
                if (textIndex < confessionTexts.length) {
                    if (confessionText.textContent !== undefined) {
                        confessionText.textContent = confessionTexts[textIndex];
                    }
                    confessionText.classList.add('show');
                    createParticles(textIndex % 2 === 0 ? "petal" : "heart");
                    textIndex++;
                } else {
                    const name = targetName || (targetNameInput ? targetNameInput.value.trim() : '');
                    if (successText.textContent !== undefined) {
                        successText.textContent = `${name}ï¼Œä½™ç”Ÿè¯·å¤šæŒ‡æ•™ ğŸ’`;
                    }
                    if (confessionModal.style) {
                        confessionModal.style.display = 'none';
                    }
                    if (successModal.style) {
                        successModal.style.display = 'flex';
                    }
                    createParticles("heart");
                }
            }

            // æ ¸å¿ƒä¿®å¤ï¼šç”Ÿæˆé“¾æ¥æŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆç¡®ä¿ç»‘å®šæˆåŠŸï¼‰
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    // å®¹é”™ï¼šæ£€æŸ¥è¾“å…¥æ¡†æ˜¯å¦å­˜åœ¨
                    if (!targetNameInput) {
                        alert('é¡µé¢å…ƒç´ åŠ è½½å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é‡è¯• ğŸ’“');
                        return;
                    }
                    
                    const inputName = targetNameInput.value.trim();
                    if (!inputName) {
                        alert('è¯·è¾“å…¥TAçš„åå­—å“¦ ğŸ’“');
                        return;
                    }
                    
                    // ç”Ÿæˆå¸¦å‚æ•°çš„é“¾æ¥ï¼ˆå…¼å®¹å„ç§URLåœºæ™¯ï¼‰
                    const currentUrl = window.location.href.split('?')[0];
                    const confessionUrl = `${currentUrl}?name=${encodeURIComponent(inputName)}`;
                    
                    // æ˜¾ç¤ºé“¾æ¥å’Œæç¤º
                    if (shareTip) shareTip.style.display = 'block';
                    if (shareLink) {
                        shareLink.style.display = 'block';
                        shareLink.textContent = confessionUrl;
                    }
                    
                    // å‰ªè´´æ¿å¤åˆ¶ï¼ˆå¢åŠ å®Œæ•´çš„å¼‚å¸¸å¤„ç†ï¼‰
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(confessionUrl)
                            .then(() => alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥å‘ç»™TAå•¦ ğŸ’Œ'))
                            .catch(err => {
                                console.log('å‰ªè´´æ¿å¤åˆ¶å¤±è´¥:', err);
                                alert('é“¾æ¥å·²ç”Ÿæˆï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å‘ç»™TA ğŸ’Œ');
                            });
                    } else {
                        // å…¼å®¹æ—§æµè§ˆå™¨
                        alert('é“¾æ¥å·²ç”Ÿæˆï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶å‘ç»™TA ğŸ’Œ');
                    }
                });
            }

            // ä¸æ„¿æ„æŒ‰é’®èº²é¿é€»è¾‘
            if (refuseBtn) {
                refuseBtn.addEventListener('mouseenter', function(e) {
                    const btn = e.target;
                    const windowWidth = window.innerWidth;
                    const windowHeight = window.innerHeight;
                    const btnWidth = btn.offsetWidth;
                    const btnHeight = btn.offsetHeight;

                    // éšæœºä½ç½®ï¼ˆç¡®ä¿åœ¨å¯è§†åŒºåŸŸå†…ï¼‰
                    const randomX = Math.random() * (windowWidth - btnWidth * 2) + btnWidth;
                    const randomY = Math.random() * (windowHeight - btnHeight * 2) + btnHeight;
                    const randomSize = Math.random() * 0.5 + 0.8;
                    const randomColor = `rgb(${Math.floor(Math.random() * 150)},${Math.floor(Math.random() * 150)},${Math.floor(Math.random() * 150)})`;

                    btn.style.position = 'absolute';
                    btn.style.left = `${randomX}px`;
                    btn.style.top = `${randomY}px`;
                    btn.style.transform = `scale(${randomSize})`;
                    btn.style.backgroundColor = randomColor;
                    btn.style.color = '#fff';
                });

                // é˜»æ­¢ç‚¹å‡»ä¸æ„¿æ„æŒ‰é’®
                refuseBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    alert('ä½ ä¸èƒ½æ‹’ç»æˆ‘ ğŸ˜œ');
                    return false;
                });
            }

            // æˆ‘æ„¿æ„æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            if (acceptBtn) {
                acceptBtn.addEventListener('click', function(e) {
                    createExplosion(e.clientX, e.clientY);
                    confessionText.classList.remove('show');
                    setTimeout(showNextText, 500);
                });
            }
        });
    </script>
</body>
</html>